<?xml version="1.0" encoding="utf-8" ?>
<!--
  * Copyright (c) 2008, 2010 Empolis GmbH and brox IT Solutions GmbH.
  * All rights reserved. This program and the accompanying materials
  * are made available under the terms of the Eclipse Public License v1.0
  * which accompanies this distribution, and is available at
  * http://www.eclipse.org/legal/epl-v10.html
  *
  * Contributors:
  * Daniel Stucky (Empolis GmbH) - initial design
  * Igor Novakovic (Empolis GmbH) - added the invocation of SolrPipelet
-->
<process name="UmlPipeline_B" targetNamespace="http://www.eclipse.org/smila/processor"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:proc="http://www.eclipse.org/smila/processor" xmlns:rec="http://www.eclipse.org/smila/record" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable">

    <import location="processor.wsdl" namespace="http://www.eclipse.org/smila/processor"
    importType="http://schemas.xmlsoap.org/wsdl/" />

  <partnerLinks>
    <partnerLink name="Pipeline" partnerLinkType="proc:ProcessorPartnerLinkType" myRole="service" />
  </partnerLinks>

  <extensions>
    <extension namespace="http://www.eclipse.org/smila/processor" mustUnderstand="no" />
  </extensions>

  <variables>
    <variable name="request" messageType="proc:ProcessorMessage" />
  </variables>

    <sequence>
        
        <receive name="start" partnerLink="Pipeline" portType="proc:ProcessorPortType"
      operation="process" variable="request" createInstance="yes" />
	
        
        <bpel:sequence>
        
        				<extensionActivity>
							<proc:invokePipelet name="invokeSplitBPipelet">
								<proc:pipelet class="it.polimi.mdir.uml.SplitBPipelet" />
								<proc:variables input="request" />     
							</proc:invokePipelet>		
						</extensionActivity>
						
                        <extensionActivity>
                        	<proc:invokePipelet name="invokeSolrIndexerPipelet_B">
								<proc:pipelet class="it.polimi.mdir.solr.SolrIndexerPipelet" />
								<proc:variables input="request" />
								<proc:configuration>
									<rec:Val key="executionMode">ADD</rec:Val>
									<rec:Val key="commitWithin" type="long">10000</rec:Val>
									<rec:Val key="coreName">text_experiment_B</rec:Val>
									<rec:Seq key="smilaFields">
										<rec:Val>projectId</rec:Val>
										<rec:Val>projectName</rec:Val>		    
										<rec:Val>className</rec:Val>
										<rec:Val>classId</rec:Val>
										<rec:Val>conceptType</rec:Val>
										<rec:Val>attributeNames</rec:Val>		
									</rec:Seq>
									<rec:Seq key="solrFields">
										<rec:Val>projectId</rec:Val>
										<rec:Val>projectName</rec:Val>
										<rec:Val>className</rec:Val>
										<rec:Val>classId</rec:Val>
										<rec:Val>conceptType</rec:Val>
										<rec:Val>attributeNames</rec:Val>					
									</rec:Seq>
								</proc:configuration>
							</proc:invokePipelet>
                        </extensionActivity>
                    
        </bpel:sequence>
        

        <reply name="end" partnerLink="Pipeline" portType="proc:ProcessorPortType" operation="process" variable="request" />
        <exit />
    </sequence>
</process>
