<?xml version="1.0" encoding="utf-8" ?>
<process name="WebMLPipeline_B" targetNamespace="http://www.eclipse.org/smila/processor"
  xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable" xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:proc="http://www.eclipse.org/smila/processor" xmlns:rec="http://www.eclipse.org/smila/record" xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable">

    <import location="processor.wsdl" namespace="http://www.eclipse.org/smila/processor"
    importType="http://schemas.xmlsoap.org/wsdl/" />

  <partnerLinks>
    <partnerLink name="Pipeline" partnerLinkType="proc:ProcessorPartnerLinkType" myRole="service" />
  </partnerLinks>

  <extensions>
    <extension namespace="http://www.eclipse.org/smila/processor" mustUnderstand="no" />
  </extensions>

  <variables>
    <variable name="request" messageType="proc:ProcessorMessage" />
  </variables>

    <sequence>
        
        <receive name="start" partnerLink="Pipeline" portType="proc:ProcessorPortType"
      operation="process" variable="request" createInstance="yes" />
	
        <bpel:flow name="Flow">
		
            <bpel:scope name="Scope1" isolated="no">
                    <bpel:sequence>
                        
                        <extensionActivity>
		    				<proc:invokePipelet name="invokeDereferencePipelet">
		        				<proc:pipelet class="it.polimi.mdir.webml.pipelet.DereferencePipelet" />
		        				<proc:variables input="request" /> 
		    				</proc:invokePipelet>
						</extensionActivity>

                        <extensionActivity>
		    				<proc:invokePipelet name="invokeSplitPipelet">
		        				<proc:pipelet class="it.polimi.mdir.webml.pipelet.SplitPipelet" />
		        				<proc:variables input="request" /> 
		    				</proc:invokePipelet>
						</extensionActivity>
						
                        		
						<extensionActivity>
		    				<proc:invokePipelet name="invokeAnalyzerSubstitutionPipelet">
		        				<proc:pipelet class="it.polimi.mdir.webml.pipelet.AnalyzerSubstitutionPipelet" />
		        				<proc:variables input="request" /> 
		        				<proc:configuration>
		        					<rec:Val key="coreName">webml_B</rec:Val>
			  						<rec:Val key="fieldType">content_analysis</rec:Val>
			  					</proc:configuration>
		    				</proc:invokePipelet>
						</extensionActivity>
						 
						<extensionActivity>
                        	<proc:invokePipelet name="invokeIndexerPipelet">
                    			<proc:pipelet class="it.polimi.mdir.webml.pipelet.IndexerPipelet" />
            					<proc:variables input="request" />
            					<proc:configuration>
              						<rec:Val key="coreName">webml_B</rec:Val>
			  						<rec:Val key="fieldType">content</rec:Val>
									<rec:Val key="indexLinks">false</rec:Val>
            					</proc:configuration>
                    		</proc:invokePipelet>
                        </extensionActivity>
						 
					</bpel:sequence>
            </bpel:scope>
        </bpel:flow>
 
<!--

SOLR-ANALYZER-PIPELET

		<extensionActivity>
          <proc:invokePipelet name="invokeSolrAnalyzerPipelet">
            <proc:pipelet class="it.polimi.mdir.solr.SolrAnalyzerPipelet" />
            <proc:variables input="request" />
            <proc:configuration>
			  <rec:Val key="writerType">xml</rec:Val>
			  <rec:Val key="indent">true</rec:Val>
              <rec:Val key="coreName">test_core</rec:Val>
			  <rec:Seq key="smilaFields">
			    <rec:Val>projectId</rec:Val>
				<rec:Val>content</rec:Val>
			  </rec:Seq>
			  <rec:Seq key="solrAnalysisTypes">
			    <rec:Val>projectId</rec:Val>
				<rec:Val>text_A</rec:Val>
			  </rec:Seq>
            </proc:configuration>
          </proc:invokePipelet>
        </extensionActivity>
-->

        <reply name="end" partnerLink="Pipeline" portType="proc:ProcessorPortType" operation="process" variable="request" />
        <exit />
    </sequence>
</process>
